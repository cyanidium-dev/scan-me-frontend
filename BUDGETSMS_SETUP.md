# Налаштування BudgetSMS для відправки SMS

## Що було реалізовано

1. **API Route** (`src/app/api/sms/route.ts`):
   - Ендпоінт для відправки SMS через BudgetSMS
   - Підтримка відправки на кілька номерів одночасно
   - Обробка помилок та логування

2. **Автоматична відправка SMS** (`src/components/emergencyInfoPage/EmergencyInfoPage.tsx`):
   - При відкритті сторінки `/emergency-info/[qrId]` автоматично відправляються SMS на всі номери екстрених контактів
   - Повідомлення містить QR-ID та ПІБ власника

## Що потрібно від вас для налаштування

### 1. Отримати облікові дані BudgetSMS

#### Крок 1: Реєстрація/Вхід
1. Зайдіть на https://www.budgetsms.net/
2. Натисніть **"Sign Up"** для реєстрації або **"Client login"** для входу в існуючий акаунт

#### Крок 2: Отримання API credentials
Після входу в акаунт:

1. **Username** (ім'я користувача):
   - Зазвичай це ваше ім'я користувача для входу
   - Можна знайти в профілі акаунту або в налаштуваннях

2. **UserID** (ID користувача):
   - Знаходиться в профілі акаунту
   - Може бути в розділі "Account Settings" або "API Settings"
   - Зазвичай це числовий ID

3. **Handle** (токен/ключ API):
   - Це ваш API ключ/токен для автентифікації
   - Знаходиться в розділі **"SMS HTTP API"** → **"API Settings"** або **"API Credentials"**
   - Може називатися "API Handle", "API Token", "API Key" або просто "Handle"
   - Якщо його немає, можливо потрібно згенерувати новий ключ

4. **API URL** (зазвичай не потрібно змінювати):
   - Стандартний URL: `https://api.budgetsms.net/sendsms`
   - Може бути вказаний в документації API

**Де шукати в панелі BudgetSMS:**
- Перейдіть в розділ **"SMS HTTP API"** → **"HTTP API"**
- Або в **"Account Settings"** / **"API Settings"**
- Перевірте документацію в розділі **"SMS HTTP API"** → **"HTTP API"** → **"Send SMS"**

**Примітка:** Якщо ви не можете знайти ці дані, зверніться до підтримки BudgetSMS або перевірте документацію API на їхньому сайті.

### 2. Додати змінні оточення

#### Для локальної розробки:

Створіть або відредагуйте файл `.env.local` в корені проекту (поруч з `package.json`):

```env
# BudgetSMS API Credentials
BUDGETSMS_USERNAME=ваш_username_з_budgetsms
BUDGETSMS_USERID=ваш_userid_з_budgetsms
BUDGETSMS_HANDLE=ваш_handle_з_budgetsms
BUDGETSMS_FROM=ScanMe
BUDGETSMS_API_URL=https://api.budgetsms.net/sendsms/
```

**Примітка про BUDGETSMS_FROM:**
- Це Sender ID (ім'я відправника), яке буде відображатися в SMS
- Може бути алфавітно-цифровим або числовим
- Максимальна довжина зазвичай 11 символів
- Приклад: "ScanMe", "Emergency", або ваш номер телефону

**Приклад:**
```env
BUDGETSMS_USERNAME=myusername
BUDGETSMS_USERID=12345
BUDGETSMS_HANDLE=abc123def456ghi789
BUDGETSMS_API_URL=https://api.budgetsms.net/sendsms
```

**Важливо:** 
- Файл `.env.local` має бути в `.gitignore` (не комітиться в git)
- Після додавання змінних перезапустіть dev сервер (`npm run dev`)

#### Для production (Vercel, Netlify, тощо):

1. **Vercel:**
   - Зайдіть в налаштування проекту
   - Розділ **"Settings"** → **"Environment Variables"**
   - Додайте всі 4 змінні

2. **Netlify:**
   - Зайдіть в налаштування сайту
   - Розділ **"Site settings"** → **"Environment variables"**
   - Додайте всі 4 змінні

3. **Інші хостинги:**
   - Знайдіть розділ "Environment Variables" або "Config Vars"
   - Додайте всі 4 змінні

### 3. Формат повідомлення

За замовчуванням повідомлення має формат:
```
QrCode ScanMe номер {qrId}. {ПІБ} було відскановано. Ймовірно трапилась екстренна ситуація.
```

Приклад:
```
QrCode ScanMe номер SM-A1C9-92. Андрій Ковальчук було відскановано. Ймовірно трапилась екстренна ситуація.
```

### 4. Тестування

1. Переконайтеся, що у профілі користувача є екстрені контакти з номерами телефонів
2. Відкрийте сторінку `/emergency-info/{qrId}` 
3. Перевірте консоль браузера та серверні логи на наявність помилок
4. Перевірте, чи прийшли SMS на вказані номери

### 5. Обробка помилок

- Якщо SMS не відправляються, перевірте:
  - Чи правильно налаштовані змінні оточення
  - Чи достатньо коштів на рахунку BudgetSMS
  - Чи правильно відформатовані номери телефонів
  - Перевірте логи сервера для деталей помилок

### 6. Документація BudgetSMS

Детальна документація API: https://www.budgetsms.net/
- HTTP API документація
- Формат запитів
- Коди помилок
- Обмеження та ліміти

## Примітки

- SMS відправляються автоматично при кожному відкритті сторінки emergency-info
- Якщо потрібно обмежити кількість відправок (наприклад, один раз на день), це можна додати через Firebase або іншу систему логування
- Номери телефонів автоматично форматуются (прибираються всі символи крім цифр)
